description "{{ project_name }}-{{ role_name }}-ballot"

start on started {{ project_name }}-{{ role_name }}
stop on stopped {{ project_name }}-{{ role_name }}

expect fork
respawn

env NODE_ENV={{ environment_name }}

{% if is_development_environment %}
env NODE_TLS_REJECT_UNAUTHORIZED=0
{% endif %}

chdir "/srv/cocorico/blockchain-worker"

pre-start script
    npm run build-ballot
end script

script
    exec forever \
        start \
        -a \
        -l {{ log_dir }}/{{ role_name }}-ballot.forever.log \
        -o {{ log_dir }}/{{ role_name }}-ballot.log \
        -e {{ log_dir }}/{{ role_name }}-ballot.error.log \
        --pidFile /var/run/{{ project_name }}-{{ role_name }}-ballot.pid \
        --sourceDir /srv/cocorico/blockchain-worker/dist/ballot \
        --workingDir /srv/cocorico/blockchain-worker/dist/ballot \
        index.js
end script

pre-stop script
    rm /var/run/{{ project_name }}-{{ role_name }}-ballot.pid
    exec forever stop /srv/cocorico/blockchain-worker/dist/ballot/index.js
end script
