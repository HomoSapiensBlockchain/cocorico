description "{{ role_name }}"

{% if is_development_environment %}
start on vagrant-mounted
{% else %}
start on startup
{% endif %}
stop on shutdown

expect fork
respawn

env NODE_ENV={{ environment_name }}
env NODE_PATH="{{ www_dir }}/{{ role_name }}/node_modules:/usr/lib/node_modules"

{% if is_development_environment %}
env NODE_TLS_REJECT_UNAUTHORIZED=0
{% endif %}

chdir "{{ www_dir }}/{{ role_name }}"

script
    exec forever --pidFile /var/run/{{ role_name }}.pid start --sourceDir {{ www_dir }}/{{ role_name }} --workingDir {{ www_dir }}/{{ role_name }} keystone.js
end script

pre-start script
end script

pre-stop script
    rm /var/run/{{ role_name }}.pid

    exec forever stop {{ www_dir }}/{{ role_name }}/keystone.js
end script
