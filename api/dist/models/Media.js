'use strict';

var keystone = require('keystone');
var transform = require('model-transform');
var config = require('/opt/cocorico/api-web/config.json');
var Types = keystone.Field.Types;

var Media = new keystone.List('Media', {
  autokey: { path: 'slug', from: 'title', unique: true },
  map: { name: 'title' },
  track: { createdAt: true, updatedAt: true }
});

var storage = new keystone.Storage({
  adapter: keystone.Storage.Adapters.FS,
  fs: {
    path: keystone.expandPath('../app/public/' + config.uploadDir),
    publicPath: '/' + config.uploadDir
  }
});

Media.add({
  title: { type: String, required: true },
  file: {
    type: Types.File,
    storage: storage,
    allowedTypes: ['image/jpeg', 'image/png', 'image/svg+xml'],
    filename: function filename(item, file) {
      return item.slug + '.' + file.extension;
    },
    format: function format(item, file) {
      return '<img src="/' + config.uploadDir + '/' + file.filename + '" style="max-width: 300px">';
    }
  }
});

transform.toJSON(Media);

Media.defaultColumns = 'title, file';
Media.register();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tb2RlbHMvTWVkaWEuanMiXSwibmFtZXMiOlsia2V5c3RvbmUiLCJyZXF1aXJlIiwidHJhbnNmb3JtIiwiY29uZmlnIiwiVHlwZXMiLCJGaWVsZCIsIk1lZGlhIiwiTGlzdCIsImF1dG9rZXkiLCJwYXRoIiwiZnJvbSIsInVuaXF1ZSIsIm1hcCIsIm5hbWUiLCJ0cmFjayIsImNyZWF0ZWRBdCIsInVwZGF0ZWRBdCIsInN0b3JhZ2UiLCJTdG9yYWdlIiwiYWRhcHRlciIsIkFkYXB0ZXJzIiwiRlMiLCJmcyIsImV4cGFuZFBhdGgiLCJ1cGxvYWREaXIiLCJwdWJsaWNQYXRoIiwiYWRkIiwidGl0bGUiLCJ0eXBlIiwiU3RyaW5nIiwicmVxdWlyZWQiLCJmaWxlIiwiRmlsZSIsImFsbG93ZWRUeXBlcyIsImZpbGVuYW1lIiwiaXRlbSIsInNsdWciLCJleHRlbnNpb24iLCJmb3JtYXQiLCJ0b0pTT04iLCJkZWZhdWx0Q29sdW1ucyIsInJlZ2lzdGVyIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQUlBLFdBQVdDLFFBQVEsVUFBUixDQUFmO0FBQ0EsSUFBSUMsWUFBWUQsUUFBUSxpQkFBUixDQUFoQjtBQUNBLElBQUlFLFNBQVNGLFFBQVEsbUNBQVIsQ0FBYjtBQUNBLElBQUlHLFFBQVFKLFNBQVNLLEtBQVQsQ0FBZUQsS0FBM0I7O0FBRUEsSUFBSUUsUUFBUSxJQUFJTixTQUFTTyxJQUFiLENBQWtCLE9BQWxCLEVBQTJCO0FBQ3JDQyxXQUFTLEVBQUVDLE1BQU0sTUFBUixFQUFnQkMsTUFBTSxPQUF0QixFQUErQkMsUUFBUSxJQUF2QyxFQUQ0QjtBQUVyQ0MsT0FBSyxFQUFFQyxNQUFNLE9BQVIsRUFGZ0M7QUFHckNDLFNBQU8sRUFBRUMsV0FBVyxJQUFiLEVBQW1CQyxXQUFXLElBQTlCO0FBSDhCLENBQTNCLENBQVo7O0FBTUEsSUFBSUMsVUFBVSxJQUFJakIsU0FBU2tCLE9BQWIsQ0FBcUI7QUFDakNDLFdBQVNuQixTQUFTa0IsT0FBVCxDQUFpQkUsUUFBakIsQ0FBMEJDLEVBREY7QUFFakNDLE1BQUk7QUFDRmIsVUFBTVQsU0FBU3VCLFVBQVQsQ0FBb0IsbUJBQWtCcEIsT0FBT3FCLFNBQTdDLENBREo7QUFFRkMsZ0JBQVksTUFBTXRCLE9BQU9xQjtBQUZ2QjtBQUY2QixDQUFyQixDQUFkOztBQVFBbEIsTUFBTW9CLEdBQU4sQ0FBVTtBQUNSQyxTQUFPLEVBQUVDLE1BQU1DLE1BQVIsRUFBZ0JDLFVBQVUsSUFBMUIsRUFEQztBQUVSQyxRQUFNO0FBQ0pILFVBQU14QixNQUFNNEIsSUFEUjtBQUVKZixhQUFTQSxPQUZMO0FBR0pnQixrQkFBYyxDQUNaLFlBRFksRUFFWixXQUZZLEVBR1osZUFIWSxDQUhWO0FBUUpDLGNBQVUsa0JBQVNDLElBQVQsRUFBZUosSUFBZixFQUFxQjtBQUM3QixhQUFPSSxLQUFLQyxJQUFMLEdBQVksR0FBWixHQUFrQkwsS0FBS00sU0FBOUI7QUFDRCxLQVZHO0FBV0pDLFlBQVEsZ0JBQVNILElBQVQsRUFBZUosSUFBZixFQUFxQjtBQUMzQixhQUFPLGdCQUFnQjVCLE9BQU9xQixTQUF2QixHQUFtQyxHQUFuQyxHQUF5Q08sS0FBS0csUUFBOUMsR0FDSCw2QkFESjtBQUVEO0FBZEc7QUFGRSxDQUFWOztBQW9CQWhDLFVBQVVxQyxNQUFWLENBQWlCakMsS0FBakI7O0FBRUFBLE1BQU1rQyxjQUFOLEdBQXVCLGFBQXZCO0FBQ0FsQyxNQUFNbUMsUUFBTiIsImZpbGUiOiJNZWRpYS5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBrZXlzdG9uZSA9IHJlcXVpcmUoJ2tleXN0b25lJyk7XG52YXIgdHJhbnNmb3JtID0gcmVxdWlyZSgnbW9kZWwtdHJhbnNmb3JtJyk7XG52YXIgY29uZmlnID0gcmVxdWlyZSgnL29wdC9jb2Nvcmljby9hcGktd2ViL2NvbmZpZy5qc29uJyk7XG52YXIgVHlwZXMgPSBrZXlzdG9uZS5GaWVsZC5UeXBlcztcblxudmFyIE1lZGlhID0gbmV3IGtleXN0b25lLkxpc3QoJ01lZGlhJywge1xuICBhdXRva2V5OiB7IHBhdGg6ICdzbHVnJywgZnJvbTogJ3RpdGxlJywgdW5pcXVlOiB0cnVlIH0sXG4gIG1hcDogeyBuYW1lOiAndGl0bGUnIH0sXG4gIHRyYWNrOiB7IGNyZWF0ZWRBdDogdHJ1ZSwgdXBkYXRlZEF0OiB0cnVlIH0sXG59KTtcblxudmFyIHN0b3JhZ2UgPSBuZXcga2V5c3RvbmUuU3RvcmFnZSh7XG4gIGFkYXB0ZXI6IGtleXN0b25lLlN0b3JhZ2UuQWRhcHRlcnMuRlMsXG4gIGZzOiB7XG4gICAgcGF0aDoga2V5c3RvbmUuZXhwYW5kUGF0aCgnLi4vYXBwL3B1YmxpYy8nKyBjb25maWcudXBsb2FkRGlyKSxcbiAgICBwdWJsaWNQYXRoOiAnLycgKyBjb25maWcudXBsb2FkRGlyLFxuICB9LFxufSk7XG5cbk1lZGlhLmFkZCh7XG4gIHRpdGxlOiB7IHR5cGU6IFN0cmluZywgcmVxdWlyZWQ6IHRydWUgfSxcbiAgZmlsZToge1xuICAgIHR5cGU6IFR5cGVzLkZpbGUsXG4gICAgc3RvcmFnZTogc3RvcmFnZSxcbiAgICBhbGxvd2VkVHlwZXM6IFtcbiAgICAgICdpbWFnZS9qcGVnJyxcbiAgICAgICdpbWFnZS9wbmcnLFxuICAgICAgJ2ltYWdlL3N2Zyt4bWwnLFxuICAgIF0sXG4gICAgZmlsZW5hbWU6IGZ1bmN0aW9uKGl0ZW0sIGZpbGUpIHtcbiAgICAgIHJldHVybiBpdGVtLnNsdWcgKyAnLicgKyBmaWxlLmV4dGVuc2lvblxuICAgIH0sXG4gICAgZm9ybWF0OiBmdW5jdGlvbihpdGVtLCBmaWxlKSB7XG4gICAgICByZXR1cm4gJzxpbWcgc3JjPVwiLycgKyBjb25maWcudXBsb2FkRGlyICsgJy8nICsgZmlsZS5maWxlbmFtZVxuICAgICAgICArICdcIiBzdHlsZT1cIm1heC13aWR0aDogMzAwcHhcIj4nO1xuICAgIH0sXG4gIH0sXG59KTtcblxudHJhbnNmb3JtLnRvSlNPTihNZWRpYSk7XG5cbk1lZGlhLmRlZmF1bHRDb2x1bW5zID0gJ3RpdGxlLCBmaWxlJztcbk1lZGlhLnJlZ2lzdGVyKCk7XG4iXX0=