'use strict';

var keystone = require('keystone');

var Page = keystone.list('Page');

/**
 * List Pages
 */
exports.list = function (req, res) {
  Page.model.find().where('published', true).exec(function (err, items) {
    if (err) return res.apiError('database error', err);

    return res.apiResponse({ pages: items });
  });
};

/**
 * List navbar Pages
 */
exports.navbar = function (req, res) {
  Page.model.find({
    published: true,
    showInNavBar: true
  }).sort('sortOrder').exec(function (err, items) {
    if (err) return res.apiError('database error', err);

    return res.apiResponse({ pages: items });
  });
};

/**
 * Get Page by ID
 */
exports.get = function (req, res) {
  Page.model.findById(req.params.id).exec(function (err, item) {
    if (err) return res.apiError('database error', err);
    if (!item) return res.apiError('not found');

    return res.apiResponse({ page: item });
  });
};

/**
 * Get Page by Slug
 */
exports.getBySlug = function (req, res) {
  Page.model.findOne({ slug: req.params.slug }).exec(function (err, item) {
    if (err) return res.apiError('database error', err);
    if (!item) return res.status(404).send();

    return res.apiResponse({ page: item });
  });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9yb3V0ZXMvYXBpL3BhZ2UuanMiXSwibmFtZXMiOlsia2V5c3RvbmUiLCJyZXF1aXJlIiwiUGFnZSIsImxpc3QiLCJleHBvcnRzIiwicmVxIiwicmVzIiwibW9kZWwiLCJmaW5kIiwid2hlcmUiLCJleGVjIiwiZXJyIiwiaXRlbXMiLCJhcGlFcnJvciIsImFwaVJlc3BvbnNlIiwicGFnZXMiLCJuYXZiYXIiLCJwdWJsaXNoZWQiLCJzaG93SW5OYXZCYXIiLCJzb3J0IiwiZ2V0IiwiZmluZEJ5SWQiLCJwYXJhbXMiLCJpZCIsIml0ZW0iLCJwYWdlIiwiZ2V0QnlTbHVnIiwiZmluZE9uZSIsInNsdWciLCJzdGF0dXMiLCJzZW5kIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQUlBLFdBQVdDLFFBQVEsVUFBUixDQUFmOztBQUVBLElBQUlDLE9BQU9GLFNBQVNHLElBQVQsQ0FBYyxNQUFkLENBQVg7O0FBRUE7OztBQUdBQyxRQUFRRCxJQUFSLEdBQWUsVUFBU0UsR0FBVCxFQUFjQyxHQUFkLEVBQW1CO0FBQ2hDSixPQUFLSyxLQUFMLENBQVdDLElBQVgsR0FDR0MsS0FESCxDQUNTLFdBRFQsRUFDc0IsSUFEdEIsRUFFR0MsSUFGSCxDQUVRLFVBQUNDLEdBQUQsRUFBTUMsS0FBTixFQUFnQjtBQUNwQixRQUFJRCxHQUFKLEVBQ0UsT0FBT0wsSUFBSU8sUUFBSixDQUFhLGdCQUFiLEVBQStCRixHQUEvQixDQUFQOztBQUVGLFdBQU9MLElBQUlRLFdBQUosQ0FBZ0IsRUFBRUMsT0FBT0gsS0FBVCxFQUFoQixDQUFQO0FBQ0QsR0FQSDtBQVFELENBVEQ7O0FBV0E7OztBQUdBUixRQUFRWSxNQUFSLEdBQWlCLFVBQVNYLEdBQVQsRUFBY0MsR0FBZCxFQUFtQjtBQUNsQ0osT0FBS0ssS0FBTCxDQUNHQyxJQURILENBQ1E7QUFDSlMsZUFBYyxJQURWO0FBRUpDLGtCQUFnQjtBQUZaLEdBRFIsRUFLQ0MsSUFMRCxDQUtNLFdBTE4sRUFNS1QsSUFOTCxDQU1VLFVBQUNDLEdBQUQsRUFBTUMsS0FBTixFQUFnQjtBQUNwQixRQUFJRCxHQUFKLEVBQVMsT0FBT0wsSUFBSU8sUUFBSixDQUFhLGdCQUFiLEVBQStCRixHQUEvQixDQUFQOztBQUVULFdBQU9MLElBQUlRLFdBQUosQ0FBZ0IsRUFBRUMsT0FBT0gsS0FBVCxFQUFoQixDQUFQO0FBQ0QsR0FWTDtBQVdELENBWkQ7O0FBY0E7OztBQUdBUixRQUFRZ0IsR0FBUixHQUFjLFVBQVNmLEdBQVQsRUFBY0MsR0FBZCxFQUFtQjtBQUMvQkosT0FBS0ssS0FBTCxDQUFXYyxRQUFYLENBQW9CaEIsSUFBSWlCLE1BQUosQ0FBV0MsRUFBL0IsRUFBbUNiLElBQW5DLENBQXdDLFVBQUNDLEdBQUQsRUFBTWEsSUFBTixFQUFlO0FBQ3JELFFBQUliLEdBQUosRUFBUyxPQUFPTCxJQUFJTyxRQUFKLENBQWEsZ0JBQWIsRUFBK0JGLEdBQS9CLENBQVA7QUFDVCxRQUFJLENBQUNhLElBQUwsRUFBVyxPQUFPbEIsSUFBSU8sUUFBSixDQUFhLFdBQWIsQ0FBUDs7QUFFWCxXQUFPUCxJQUFJUSxXQUFKLENBQWdCLEVBQUVXLE1BQU9ELElBQVQsRUFBaEIsQ0FBUDtBQUNELEdBTEQ7QUFNRCxDQVBEOztBQVNBOzs7QUFHQXBCLFFBQVFzQixTQUFSLEdBQW9CLFVBQVNyQixHQUFULEVBQWNDLEdBQWQsRUFBbUI7QUFDckNKLE9BQUtLLEtBQUwsQ0FBV29CLE9BQVgsQ0FBbUIsRUFBQ0MsTUFBT3ZCLElBQUlpQixNQUFKLENBQVdNLElBQW5CLEVBQW5CLEVBQTZDbEIsSUFBN0MsQ0FBa0QsVUFBQ0MsR0FBRCxFQUFNYSxJQUFOLEVBQWU7QUFDL0QsUUFBSWIsR0FBSixFQUNFLE9BQU9MLElBQUlPLFFBQUosQ0FBYSxnQkFBYixFQUErQkYsR0FBL0IsQ0FBUDtBQUNGLFFBQUksQ0FBQ2EsSUFBTCxFQUNFLE9BQU9sQixJQUFJdUIsTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLEVBQVA7O0FBRUYsV0FBT3hCLElBQUlRLFdBQUosQ0FBZ0IsRUFBRVcsTUFBT0QsSUFBVCxFQUFoQixDQUFQO0FBQ0QsR0FQRDtBQVFELENBVEQiLCJmaWxlIjoicGFnZS5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBrZXlzdG9uZSA9IHJlcXVpcmUoJ2tleXN0b25lJyk7XG5cbnZhciBQYWdlID0ga2V5c3RvbmUubGlzdCgnUGFnZScpO1xuXG4vKipcbiAqIExpc3QgUGFnZXNcbiAqL1xuZXhwb3J0cy5saXN0ID0gZnVuY3Rpb24ocmVxLCByZXMpIHtcbiAgUGFnZS5tb2RlbC5maW5kKClcbiAgICAud2hlcmUoJ3B1Ymxpc2hlZCcsIHRydWUpXG4gICAgLmV4ZWMoKGVyciwgaXRlbXMpID0+IHtcbiAgICAgIGlmIChlcnIpXG4gICAgICAgIHJldHVybiByZXMuYXBpRXJyb3IoJ2RhdGFiYXNlIGVycm9yJywgZXJyKTtcblxuICAgICAgcmV0dXJuIHJlcy5hcGlSZXNwb25zZSh7IHBhZ2VzOiBpdGVtcyB9KTtcbiAgICB9KTtcbn1cblxuLyoqXG4gKiBMaXN0IG5hdmJhciBQYWdlc1xuICovXG5leHBvcnRzLm5hdmJhciA9IGZ1bmN0aW9uKHJlcSwgcmVzKSB7XG4gIFBhZ2UubW9kZWxcbiAgICAuZmluZCh7XG4gICAgICBwdWJsaXNoZWQgXHRcdDogdHJ1ZSxcbiAgICAgIHNob3dJbk5hdkJhciBcdDogdHJ1ZSxcbiAgICB9KVxuXHRcdC5zb3J0KCdzb3J0T3JkZXInKVxuICAgICAgLmV4ZWMoKGVyciwgaXRlbXMpID0+IHtcbiAgICAgICAgaWYgKGVycikgcmV0dXJuIHJlcy5hcGlFcnJvcignZGF0YWJhc2UgZXJyb3InLCBlcnIpO1xuXG4gICAgICAgIHJldHVybiByZXMuYXBpUmVzcG9uc2UoeyBwYWdlczogaXRlbXMgfSk7XG4gICAgICB9KTtcbn1cblxuLyoqXG4gKiBHZXQgUGFnZSBieSBJRFxuICovXG5leHBvcnRzLmdldCA9IGZ1bmN0aW9uKHJlcSwgcmVzKSB7XG4gIFBhZ2UubW9kZWwuZmluZEJ5SWQocmVxLnBhcmFtcy5pZCkuZXhlYygoZXJyLCBpdGVtKSA9PiB7XG4gICAgaWYgKGVycikgcmV0dXJuIHJlcy5hcGlFcnJvcignZGF0YWJhc2UgZXJyb3InLCBlcnIpO1xuICAgIGlmICghaXRlbSkgcmV0dXJuIHJlcy5hcGlFcnJvcignbm90IGZvdW5kJyk7XG5cbiAgICByZXR1cm4gcmVzLmFwaVJlc3BvbnNlKHsgcGFnZSA6IGl0ZW0gfSk7XG4gIH0pO1xufVxuXG4vKipcbiAqIEdldCBQYWdlIGJ5IFNsdWdcbiAqL1xuZXhwb3J0cy5nZXRCeVNsdWcgPSBmdW5jdGlvbihyZXEsIHJlcykge1xuICBQYWdlLm1vZGVsLmZpbmRPbmUoe3NsdWcgOiByZXEucGFyYW1zLnNsdWd9KS5leGVjKChlcnIsIGl0ZW0pID0+IHtcbiAgICBpZiAoZXJyKVxuICAgICAgcmV0dXJuIHJlcy5hcGlFcnJvcignZGF0YWJhc2UgZXJyb3InLCBlcnIpO1xuICAgIGlmICghaXRlbSlcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuc2VuZCgpO1xuXG4gICAgcmV0dXJuIHJlcy5hcGlSZXNwb25zZSh7IHBhZ2UgOiBpdGVtIH0pO1xuICB9KTtcbn1cbiJdfQ==